<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>凡客诚品主页</title>
    <link rel="stylesheet" href="css/reset.css">
    <link rel="stylesheet" href="css/common.css">
</head>

<body>
    <div id="header_wrapper">
        <div class="header content">
            <p>您好,欢迎光临凡客诚品！</p>
            <a href="#">登录</a>
            <span>|</span>
            <a href="#">注册</a>
            <a href="#">我的订单</a>
            <a href="#"><img src="image/common_img/notice.png" />网站公告</a>
            <a href="#"><img src="image/common_img/w1.jpg" />
                <span class="weibomap"></span>
            </a>
            <a href="#"><img src="image/common_img/w2.jpg" /></a>
        </div>
    </div>
    <!-- 头部结束 -->
    <!-- 搜索部分开始 -->
    <div id="search-wrapper">
        <div class="search content">
            <div class="search_top">
                <form action="" method="GET" class="search_box">
                    <input type="text" class="search_input" name="ss" placeholder="搜“日式免烫衬衫”，体验与众不同">
                    <ul class="search_result">
                        <!-- <li>haha</li> -->
                    </ul>
                    <input type="submit" value="搜 索" class="search_ss">
                </form>
                <div class="shopping_cart">
                    <div class="shopping_carttop">
                        <a href="#">
                            购物车（<span>0</span>）
                        </a>
                    </div>
                    <div class="shopping_cartbottom">
                        <h2>您的购物车中没有任何商品</h2>

                    </div>
                </div>
            </div>
            <div class="search_bottom">
                <p>
                    <span>热门搜索：</span>
                    <a href="#">免烫衬衫</a>
                    <a href="#">羽绒服</a>
                    <a href="#">外套</a>
                    <a href="#">熊本熊</a>
                    <a href="#">运动户外</a>
                    <a href="#">帆布鞋</a>
                    <a href="#">水柔绵</a>
                </p>
            </div>
        </div>
    </div>






    <!-- <script>开始 -->
    <!-- 搜索框功能 -->
    <script src="js/search_jsonp.js"></script>
    <!-- <script src="js/ajax.js"></script> -->
    <script>
        const searchInp = (function () {
            function fn() {

            }
            return {
                init(ele) {
                    this.$searchBox = document.querySelector(ele);
                    this.$searchInp = this.$searchBox.querySelector('.search_input');
                    this.$searchRes = this.$searchBox.querySelector('.search_result');
                    this.event();
                },
                event() {
                    const _this = this;
                    const $inp = this.$searchInp
                    $inp.oninput = function () {
                        if (this.value != '') {
                            // 获取数据
                            clearTimeout(this.time);
                            // 减少http请求
                            this.time = setTimeout(_ => {
                                _this.getData(this.value);
                            }, 500)
                        } else {
                            _this.$searchRes.style.display = 'none';
                        }
                    }
                    $inp.onfocus = function () {
                        if (this.value != '') {
                            _this.$searchRes.style.display = 'block';
                        }
                    }
                    $inp.onblur = function () {
                        // 隐藏结果栏
                        _this.$searchRes.style.display = 'none';

                    }
                },
                // 获取数据
                getData(val) {
                    const _this = this;
                    //    sendAjax('json/search.json', {
                    //        data: {
                    //            wd: val
                    //        }
                    //    }).then(data => {
                    //        console.log(data);
                    //        data = JSON.parse(data);
                    //        _this.insertData(data.s);
                    //    })
                    
                    sendJsonp('http://page.vanclimg.com/autocompletehandler.ashx', {
                        wd: val,
                        cb: "insertData"
                    })
                },
                // 把数据渲染到列表中
                insertData(data) {
                    console.log(data);
                    data = data.s;
                    this.$searchRes.innerHTML = '';
                    for (let i = 0; i < data.length; i++) {
                        let $li = document.createElement('li');
                        $li.innerHTML = data[i];
                        this.$searchRes.appendChild($li);
                    }
                    this.$searchRes.style.display = 'block';
                }
            }
        }())
        searchInp.init('.search_box');


    </script>
    <script>
        // call, apply, bind
        var insertData = searchInp.insertData.bind(searchInp);

    </script>
</body>

</html>